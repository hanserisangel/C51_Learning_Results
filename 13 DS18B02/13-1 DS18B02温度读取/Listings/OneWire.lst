C51 COMPILER V9.54   ONEWIRE                                                               01/31/2024 12:33:00 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE ONEWIRE
OBJECT MODULE PLACED IN .\Objects\OneWire.obj
COMPILER INVOKED BY: F:\Keil5\C51\BIN\C51.EXE OneWire.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\One
                    -Wire.lst) OBJECT(.\Objects\OneWire.obj)

line level    source

   1          #include <REGF51RC.H>
   2          
   3          sbit OneWire_DQ = P3^7;
   4          
   5          void Delay480us()               //@11.0592MHz
   6          {
   7   1              unsigned char i;
   8   1      
   9   1              i = 218;
  10   1              while (--i);
  11   1      }
  12          
  13          void Delay70us()                //@11.0592MHz
  14          {
  15   1              unsigned char i;
  16   1      
  17   1              i = 29;
  18   1              while (--i);
  19   1      }
  20          
  21          void Delay10us()                //@11.0592MHz
  22          {
  23   1              unsigned char i;
  24   1      
  25   1              i = 2;
  26   1              while (--i);
  27   1      }
  28          
  29          void Delay50us()                //@11.0592MHz
  30          {
  31   1              unsigned char i;
  32   1      
  33   1              i = 20;
  34   1              while (--i);
  35   1      }
  36          
  37          void Delay5us()         //@11.0592MHz
  38          {
  39   1      }
  40          
  41          
  42          bit OneWire_Init()
  43          {
  44   1              bit ACK;
  45   1              OneWire_DQ = 1;
  46   1              OneWire_DQ = 0; // 主机发送
  47   1              Delay480us();
  48   1              
  49   1              OneWire_DQ = 1; // 释放总线
  50   1              
  51   1              Delay70us();
  52   1              ACK = OneWire_DQ; // 从机应答
  53   1              
  54   1              Delay480us(); // 保证时间片长度在手册规定范围内
C51 COMPILER V9.54   ONEWIRE                                                               01/31/2024 12:33:00 PAGE 2   

  55   1              
  56   1              return ACK;
  57   1      }
  58          
  59          // 发送 1 位
  60          void OneWire_SendBit(bit Bit)
  61          {
  62   1              OneWire_DQ = 1;
  63   1              OneWire_DQ = 0; // 主机发送
  64   1              Delay10us();
  65   1              OneWire_DQ = Bit;
  66   1              Delay50us(); // 保证时间片长度在手册规定范围内
  67   1              
  68   1              OneWire_DQ = 1; // 释放总线
  69   1      }
  70          
  71          // 接收 1 位
  72          bit OneWire_ReceiveBit()
  73          {
  74   1              bit Bit;
  75   1              OneWire_DQ = 1;
  76   1              OneWire_DQ = 0; // 主机发送
  77   1              Delay5us();
  78   1              OneWire_DQ = 1;
  79   1              Delay5us();
  80   1              
  81   1              Bit = OneWire_DQ;
  82   1              Delay50us(); // 保证时间片长度在手册规定范围内
  83   1              return Bit;
  84   1      }
  85          
  86          // 发送 1 个字节
  87          void OneWire_SendByte(unsigned char Byte)
  88          {
  89   1              unsigned char i;
  90   1              for(i = 0; i < 8; i ++)
  91   1              {
  92   2                      OneWire_SendBit(Byte & (0x01<<i));
  93   2              }
  94   1      }
  95          
  96          // 接收 1 个字节
  97          unsigned char OneWire_ReceiveByte()
  98          {
  99   1              unsigned char i;
 100   1              unsigned char Byte = 0x00;
 101   1              for(i = 0; i < 8; i ++)
 102   1              {
 103   2                      if(OneWire_ReceiveBit()) Byte |= (0x01 << i);
 104   2              }
 105   1              return Byte;
 106   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    149    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       3
C51 COMPILER V9.54   ONEWIRE                                                               01/31/2024 12:33:00 PAGE 3   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
