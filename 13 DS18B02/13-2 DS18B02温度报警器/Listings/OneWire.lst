C51 COMPILER V9.54   ONEWIRE                                                               01/31/2024 14:01:56 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE ONEWIRE
OBJECT MODULE PLACED IN .\Objects\OneWire.obj
COMPILER INVOKED BY: F:\Keil5\C51\BIN\C51.EXE OneWire.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\One
                    -Wire.lst) OBJECT(.\Objects\OneWire.obj)

line level    source

   1          #include <REGF51RC.H>
   2          
   3          sbit OneWire_DQ = P3^7;
   4          
   5          void Delay480us()               //@11.0592MHz
   6          {
   7   1              unsigned char i;
   8   1      
   9   1              i = 218;
  10   1              while (--i);
  11   1      }
  12          
  13          void Delay70us()                //@11.0592MHz
  14          {
  15   1              unsigned char i;
  16   1      
  17   1              i = 29;
  18   1              while (--i);
  19   1      }
  20          
  21          void Delay10us()                //@11.0592MHz
  22          {
  23   1              unsigned char i;
  24   1      
  25   1              i = 2;
  26   1              while (--i);
  27   1      }
  28          
  29          void Delay50us()                //@11.0592MHz
  30          {
  31   1              unsigned char i;
  32   1      
  33   1              i = 20;
  34   1              while (--i);
  35   1      }
  36          
  37          void Delay5us()         //@11.0592MHz
  38          {
  39   1      }
  40          
  41          // 初始化
  42          bit OneWire_Init()
  43          {
  44   1              bit ACK;
  45   1              EA = 0;
  46   1              OneWire_DQ = 1;
  47   1              OneWire_DQ = 0; // 主机发送
  48   1              Delay480us();
  49   1              
  50   1              OneWire_DQ = 1; // 释放总线
  51   1              
  52   1              Delay70us();
  53   1              ACK = OneWire_DQ; // 从机应答
  54   1              
C51 COMPILER V9.54   ONEWIRE                                                               01/31/2024 14:01:56 PAGE 2   

  55   1              Delay480us(); // 保证时间片长度在手册规定范围内
  56   1              
  57   1              EA = 1;
  58   1              
  59   1              return ACK;
  60   1      }
  61          
  62          // 发送 1 位
  63          void OneWire_SendBit(bit Bit)
  64          {
  65   1              EA = 0;
  66   1              OneWire_DQ = 1;
  67   1              OneWire_DQ = 0; // 主机发送
  68   1              Delay10us();
  69   1              OneWire_DQ = Bit;
  70   1              Delay50us(); // 保证时间片长度在手册规定范围内
  71   1              
  72   1              OneWire_DQ = 1; // 释放总线
  73   1              EA = 1;
  74   1      }
  75          
  76          // 接收 1 位
  77          bit OneWire_ReceiveBit()
  78          {
  79   1              bit Bit;
  80   1              EA = 0;
  81   1              OneWire_DQ = 1;
  82   1              OneWire_DQ = 0; // 主机发送
  83   1              Delay5us();
  84   1              OneWire_DQ = 1;
  85   1              Delay5us();
  86   1              
  87   1              Bit = OneWire_DQ;
  88   1              Delay50us(); // 保证时间片长度在手册规定范围内
  89   1              EA = 1;
  90   1              return Bit;
  91   1      }
  92          
  93          // 发送 1 个字节
  94          void OneWire_SendByte(unsigned char Byte)
  95          {
  96   1              unsigned char i;
  97   1              for(i = 0; i < 8; i ++)
  98   1              {
  99   2                      OneWire_SendBit(Byte & (0x01<<i));
 100   2              }
 101   1      }
 102          
 103          // 接收 1 个字节
 104          unsigned char OneWire_ReceiveByte()
 105          {
 106   1              unsigned char i;
 107   1              unsigned char Byte = 0x00;
 108   1              for(i = 0; i < 8; i ++)
 109   1              {
 110   2                      if(OneWire_ReceiveBit()) Byte |= (0x01 << i);
 111   2              }
 112   1              return Byte;
 113   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V9.54   ONEWIRE                                                               01/31/2024 14:01:56 PAGE 3   

   CODE SIZE        =    161    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       3
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
