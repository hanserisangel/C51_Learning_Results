C51 COMPILER V9.54   MAIN                                                                  01/28/2024 13:27:23 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: F:\Keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.l
                    -st) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGF51RC.H>
   2          #include "LCD1602.h"
   3          #include "DS1302.h"
   4          #include "Key.h"
   5          #include "Timer.h"
   6          
   7          unsigned char KeyNum, KeyMode, KeySel, flag;
   8          
   9          void TimeShow()
  10          {
  11   1              DS1302_ReadTime();
  12   1                      
  13   1              // BCD码 → 十进制
  14   1              LCD_ShowNum(1, 3, time[0], 2);
  15   1              LCD_ShowNum(1, 6, time[1], 2);
  16   1              LCD_ShowNum(1, 9, time[2], 2);
  17   1              
  18   1              LCD_ShowNum(2, 1, time[3], 2);
  19   1              LCD_ShowNum(2, 4, time[4], 2);
  20   1              LCD_ShowNum(2, 7, time[5], 2);
  21   1      }
  22          
  23          void TimeSet()
  24          {
  25   1              // 第 1 个按键: 用来选择调整位(0: 年; 1: 月; ...)
  26   1              if(KeyNum == 2)
  27   1              {
  28   2                      KeySel ++;
  29   2                      KeySel = KeySel % 6;
  30   2              }
  31   1              
  32   1              if(KeyNum == 3) // 增加按键
  33   1              {
  34   2                      time[KeySel] ++;
  35   2                      if(time[0] > 99) time[0] = 0; // 年越界
  36   2                      if(time[1] > 12) time[1] = 1; // 月越界
  37   2                      
  38   2                      // 日越界
  39   2                      if( time[1] == 1 || time[1] == 3 || time[1] == 5 || time[1] == 7 || 
  40   2                              time[1] == 8 || time[1] == 10 || time[1] == 12)
  41   2                      {
  42   3                              if(time[2] > 31) time[2] = 1;
  43   3                      }
  44   2                      else if(time[1] == 4 || time[1] == 6 || time[1] == 9 || time[1] == 11)
  45   2                      {
  46   3                              if(time[2] > 30) time[2] = 1;
  47   3                      }
  48   2                      else if(time[1] == 2)
  49   2                      {
  50   3                              if(time[0]%4 == 0)
  51   3                              {
  52   4                                      if(time[2] > 29) time[2] = 1;
  53   4                              }
  54   3                              else
C51 COMPILER V9.54   MAIN                                                                  01/28/2024 13:27:23 PAGE 2   

  55   3                              {
  56   4                                      if(time[2] > 28) time[2] = 1;
  57   4                              }
  58   3                      }
  59   2                      
  60   2                      if(time[3] > 23) time[3] = 0; // 时越界
  61   2                      if(time[4] > 59) time[4] = 0; // 分越界
  62   2                      if(time[5] > 59) time[5] = 0; // 秒越界
  63   2              }
  64   1              
  65   1              if(KeyNum == 4) // 减小按键
  66   1              {
  67   2                      time[KeySel] --;
  68   2                      if(time[0] < 0) time[0] = 99;
  69   2                      if(time[1] < 1) time[1] = 12;
  70   2                      if( time[1] == 1 || time[1] == 3 || time[1] == 5 || time[1] == 7 || 
  71   2                              time[1] == 8 || time[1] == 10 || time[1] == 12)
  72   2                      {
  73   3                              if(time[2] < 1) time[2] = 31;
  74   3                              if(time[2] > 31) time[2] = 1;
  75   3                      }
  76   2                      else if(time[1] == 4 || time[1] == 6 || time[1] == 9 || time[1] == 11)
  77   2                      {
  78   3                              if(time[2] < 1) time[2] = 30;
  79   3                              if(time[2] > 30) time[2] = 1;
  80   3                      }
  81   2                      else if(time[1] == 2)
  82   2                      {
  83   3                              if(time[0]%4 == 0)
  84   3                              {
  85   4                                      if(time[2] < 1) time[2] = 29;
  86   4                                      if(time[2] > 29) time[2] = 1;
  87   4                              }
  88   3                              else
  89   3                              {
  90   4                                      if(time[2] < 1) time[2] = 28;
  91   4                                      if(time[2] > 28) time[2] = 1;
  92   4                              }
  93   3                      }
  94   2                      if(time[3] < 0) time[3] = 23;
  95   2                      if(time[4] < 0) time[4] = 59;
  96   2                      if(time[5] < 0) time[5] = 59;
  97   2              }
  98   1              
  99   1              if(KeySel==0 && flag==1) LCD_ShowString(1, 3, "  ");
 100   1              else LCD_ShowNum(1, 3, time[0], 2);
 101   1              if(KeySel==1 && flag==1) LCD_ShowString(1, 6, "  ");
 102   1              else LCD_ShowNum(1, 6, time[1], 2);
 103   1              if(KeySel==2 && flag==1) LCD_ShowString(1, 9, "  ");
 104   1              else LCD_ShowNum(1, 9, time[2], 2);
 105   1              if(KeySel==3 && flag==1) LCD_ShowString(2, 1, "  ");
 106   1              else LCD_ShowNum(2, 1, time[3], 2);
 107   1              if(KeySel==4 && flag==1) LCD_ShowString(2, 4, "  ");
 108   1              else LCD_ShowNum(2, 4, time[4], 2);
 109   1              if(KeySel==5 && flag==1) LCD_ShowString(2, 7, "  ");
 110   1              else LCD_ShowNum(2, 7, time[5], 2);
 111   1      }
 112          
 113          int main()
 114          {
 115   1              LCD_Init();
 116   1              DS1302_Init();
C51 COMPILER V9.54   MAIN                                                                  01/28/2024 13:27:23 PAGE 3   

 117   1              DS1302_SetTime();
 118   1              Timer_Init();
 119   1              
 120   1              LCD_ShowString(1, 1, "20  -  -");
 121   1              LCD_ShowString(2, 1, "  :  :");
 122   1              while(1)
 123   1              {
 124   2                      KeyNum = Key();
 125   2                      
 126   2                      // 第 1 个按键: 用来切换模式(0: 走时; 1: 调时)
 127   2                      if(KeyNum == 1)
 128   2                      {
 129   3                              if(KeyMode == 1)
 130   3                              {
 131   4                                      KeyMode = 0;
 132   4                                      DS1302_SetTime();
 133   4                              }
 134   3                              else if(KeyMode == 0)
 135   3                              {
 136   4                                      KeyMode = 1;
 137   4                                      KeySel = 0;
 138   4                              }
 139   3                      }
 140   2                      switch(KeyMode)
 141   2                      {
 142   3                              case 0: TimeShow(); break;
 143   3                              case 1: TimeSet(); break;
 144   3                      }
 145   2              }
 146   1      }
 147          
 148          unsigned int Count;
 149          void hanser() interrupt 1
 150          {
 151   1              TL0 = 0x66;     
 152   1              TH0 = 0xFC;     
 153   1              Count++;
 154   1              if(Count >= 500)
 155   1              {
 156   2                      Count = 0;
 157   2                      flag = !flag;
 158   2              }
 159   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    969    ----
   CONSTANT SIZE    =     19    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
