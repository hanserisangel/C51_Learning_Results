C51 COMPILER V9.54   MAIN                                                                  01/29/2024 11:32:50 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: F:\Keil5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.l
                    -st) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGF51RC.H>
   2          #include "Timer.h"
   3          #include "Delay.h"
   4          
   5          #define TIME_Quarter_note 250
   6          // 4 分音符的一拍 500ms 或 250ms
   7          sbit Buzzer = P2^5;
   8          
   9          unsigned char FreqSel, MusicSel;
  10          
  11          unsigned int Freq[] = {
  12                  0, // 休止符
  13                  63777, 63872, 63969, 64054, 64140, 64216, 64291, 64360, 64426, 64489, 64547, 64603,
  14                  64655, 64704, 64751, 64795, 64837, 64876, 64913, 64948, 64981, 65012, 65042, 65070,
  15                  65095, 65120, 65144, 65166, 65186, 65206, 65225, 65242, 65259, 65274, 65289, 65303
  16          };
  17          
  18          // 乐谱: pair(音高数组的索引, 音符的时长)
  19          unsigned char Music[] = {
  20                  // 一闪一闪亮晶晶
  21                  13, 1,
  22                  13, 1,
  23                  20, 1,
  24                  20, 1,
  25                  22, 1,
  26                  22, 1,
  27                  20, 2,
  28                  
  29                  // 满天都是小星星
  30                  18, 1,
  31                  18, 1,
  32                  17, 1,
  33                  17, 1,
  34                  15, 1,
  35                  15, 1,
  36                  13, 2,
  37                  
  38                  0xff // 终止符, 防数组越界
  39          };
  40          
  41          int main()
  42          {
  43   1              Timer_Init();
  44   1              while(1)
  45   1              {
  46   2                      if(Music[MusicSel] != 0xff) // 终止符
  47   2                      {
  48   3                              // 确定音高
  49   3                              FreqSel = Music[MusicSel];
  50   3                              MusicSel ++;
  51   3                              
  52   3                              // 确定音长
  53   3                              Delay(TIME_Quarter_note * Music[MusicSel]);
  54   3                              MusicSel ++;
C51 COMPILER V9.54   MAIN                                                                  01/29/2024 11:32:50 PAGE 2   

  55   3                              
  56   3                              // 断音, 不要连音
  57   3                              TR0 = 0; // 关闭定时器
  58   3                              Delay(5);
  59   3                              TR0 = 1; // 打开定时器
  60   3                      }
  61   2                      else
  62   2                      {
  63   3                              TR0 = 0; // 关闭定时器
  64   3                      }
  65   2              }
  66   1      }
  67          
  68          void hanser() interrupt 1
  69          {
  70   1              if(Freq[FreqSel])
  71   1              {
  72   2                      // 修改频率
  73   2                      TL0 = Freq[FreqSel] % 256; // 低 8 位
  74   2                      TH0 = Freq[FreqSel] / 256; // 高 8 位
  75   2                      
  76   2                      // 翻转电平, 生成波形
  77   2                      Buzzer = !Buzzer;
  78   2              }
  79   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    104    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =    105    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
